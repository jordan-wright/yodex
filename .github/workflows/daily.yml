name: Audio Debug

on:
  workflow_dispatch:
    inputs:
      date:
        description: "UTC date (YYYY-MM-DD)"
        required: false
        type: string

jobs:
  debug:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ffmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Set date
        id: date
        run: |
          if [ -n "${{ inputs.date }}" ]; then
            DATE_VAL="${{ inputs.date }}"
          else
            DATE_VAL="$(date -u +%F)"
          fi
          echo "value=${DATE_VAL}" >> "$GITHUB_OUTPUT"
          echo "path=$(date -u -d "${DATE_VAL}" +%Y/%m/%d)" >> "$GITHUB_OUTPUT"

      - name: Debug audio assets
        run: |
          echo "PWD: $(pwd)"
          ls -la
          ls -la assets || true
          ls -la assets/audio || true
          echo "pause asset:"
          ls -la assets/audio/pause7s.mp3 || true
          ffmpeg -hide_banner -loglevel error -i assets/audio/pause7s.mp3 -f null - || true
          echo "section mp3s:"
          ls -la out/${{ steps.date.outputs.path }}/*.mp3 || true
